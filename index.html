<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Game Dikejar Hantu</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #111;
      overflow: hidden;
      touch-action: none;
    }
    canvas {
      display: block;
      margin: auto;
      background: #222;
    }
    #joystick {
      position: absolute;
      bottom: 120px;
      left: 30px;
      width: 120px;
      height: 120px;
      background: rgba(255,255,255,0.1);
      border-radius: 50%;
      z-index: 2;
    }
    #stick {
      position: absolute;
      top: 35px;
      left: 35px;
      width: 50px;
      height: 50px;
      background: rgba(255,255,255,0.4);
      border-radius: 50%;
    }
    #fireBtn {
      position: absolute;
      bottom: 130px;
      right: 30px;
      width: 70px;
      height: 70px;
      background: red;
      border-radius: 50%;
      z-index: 2;
      border: 3px solid white;
    }
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-family: sans-serif;
      font-size: 14px;
    }
    .bar {
      width: 100px;
      height: 10px;
      background: #444;
      margin-bottom: 5px;
    }
    .fill {
      height: 10px;
      background: lime;
    }
    #startMsg {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 40px;
      font-family: sans-serif;
      animation: countdown 3s steps(3, end) forwards;
    }
    @keyframes countdown {
      0%   { content: "3"; opacity: 1; }
      33%  { content: "2"; opacity: 1; }
      66%  { content: "1"; opacity: 1; }
      100% { opacity: 0; }
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="360" height="640"></canvas>
  <div id="joystick"><div id="stick"></div></div>
  <div id="fireBtn"></div>
  <div id="ui">
    <div>Hantu HP</div>
    <div class="bar"><div id="ghostHp" class="fill" style="width: 100%;"></div></div>
    <div>Power</div>
    <div class="bar"><div id="powerBar" class="fill" style="width: 10%; background: cyan;"></div></div>
  </div>
  <div id="startMsg">3</div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const player = { x: canvas.width / 2 - 20, y: canvas.height / 2 - 20, size: 40, speed: 2, power: 10 };
    const ghost = { x: canvas.width / 2 + 50, y: canvas.height / 2 - 20, size: 40, speed: 1.2, hp: 50, state: "chase", hitTimer: 0 };

    const obstacles = Array.from({length: 12}, () => ({
      x: Math.random() * 300,
      y: Math.random() * 580,
      width: 30,
      height: 30
    }));

    const powerBox = { x: 100, y: 200, size: 30 };
    const velocity = { x: 0, y: 0 };
    let bullets = [];

    let gameStarted = false;
    const startMsg = document.getElementById("startMsg");

    setTimeout(() => {
      gameStarted = true;
      startMsg.style.display = 'none';
    }, 3000);

    const playerIdle = new Image(), playerRun = new Image();
    const ghostChase = new Image(), ghostHit = new Image(), ghostAngry = new Image();
    const powerBoxImg = new Image();

    playerIdle.src = "https://i.imgur.com/6o5lPHr.png";
    playerRun.src = "https://i.imgur.com/X2Cw1D5.png";
    ghostChase.src = "hantuapril1.png";
    ghostHit.src = "https://i.imgur.com/L7x0kFZ.png";
    ghostAngry.src = "https://i.imgur.com/mW6NIXL.png";
    powerBoxImg.src = "https://i.imgur.com/3aFqFvl.png";

    const joystick = document.getElementById("joystick");
    const stick = document.getElementById("stick");
    let dragging = false;
    let origin = { x: 0, y: 0 };

    joystick.addEventListener("touchstart", e => {
      dragging = true;
      const touch = e.touches[0];
      origin.x = touch.clientX;
      origin.y = touch.clientY;
    });

    joystick.addEventListener("touchmove", e => {
      if (!dragging) return;
      const touch = e.touches[0];
      const dx = touch.clientX - origin.x;
      const dy = touch.clientY - origin.y;

      const maxDist = 40;
      const dist = Math.min(maxDist, Math.hypot(dx, dy));
      const angle = Math.atan2(dy, dx);

      stick.style.left = 35 + dist * Math.cos(angle) + "px";
      stick.style.top = 35 + dist * Math.sin(angle) + "px";

      velocity.x = Math.cos(angle) * (dist / maxDist);
      velocity.y = Math.sin(angle) * (dist / maxDist);
    });

    joystick.addEventListener("touchend", () => {
      dragging = false;
      stick.style.left = "35px";
      stick.style.top = "35px";
      velocity.x = 0;
      velocity.y = 0;
    });

    document.getElementById("fireBtn").addEventListener("click", () => {
      if (player.power >= 10) {
        bullets.push({ x: player.x + 20, y: player.y + 20, dx: 3 * velocity.x, dy: 3 * velocity.y });
        player.power -= 10;
        document.getElementById("powerBar").style.width = player.power + "%";
      }
    });

    function update() {
      if (!gameStarted) return;

      let nextX = player.x + velocity.x * player.speed;
      let nextY = player.y + velocity.y * player.speed;

      let blocked = obstacles.some(ob =>
        nextX < ob.x + ob.width && nextX + player.size > ob.x &&
        nextY < ob.y + ob.height && nextY + player.size > ob.y
      );

      if (!blocked) {
        player.x = nextX;
        player.y = nextY;
      }

      if (ghost.hitTimer > 0) {
        ghost.hitTimer--;
        ghost.state = "hit";
        if (ghost.hitTimer === 0) ghost.state = "angry";
        return;
      }

      let dx = player.x - ghost.x;
      let dy = player.y - ghost.y;
      let dist = Math.hypot(dx, dy);
      ghost.x += (dx / dist) * ghost.speed;
      ghost.y += (dy / dist) * ghost.speed;

      if (Math.abs(player.x - ghost.x) < 30 && Math.abs(player.y - ghost.y) < 30) {
        alert("Kena hantu!");
        location.reload();
      }

      bullets.forEach((b, i) => {
        b.x += b.dx;
        b.y += b.dy;
        if (b.x > ghost.x && b.x < ghost.x + ghost.size &&
            b.y > ghost.y && b.y < ghost.y + ghost.size) {
          ghost.hp -= 10;
          document.getElementById("ghostHp").style.width = ghost.hp + "%";
          bullets.splice(i, 1);
          ghost.hitTimer = 60;
        }
      });

      if (Math.abs(player.x - powerBox.x) < 30 && Math.abs(player.y - powerBox.y) < 30) {
        if (player.power < 100) {
          player.power += 10;
          document.getElementById("powerBar").style.width = player.power + "%";
          powerBox.x = Math.random() * 300;
          powerBox.y = Math.random() * 600;
        }
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      ctx.drawImage(powerBoxImg, powerBox.x, powerBox.y, 30, 30);
      obstacles.forEach(ob => {
        ctx.fillStyle = "#555";
        ctx.fillRect(ob.x, ob.y, ob.width, ob.height);
      });

      const playerImg = (velocity.x === 0 && velocity.y === 0) ? playerIdle : playerRun;
      if (playerImg.complete) {
        ctx.drawImage(playerImg, player.x, player.y, player.size, player.size);
      }

      let ghostImg = ghostChase;
      if (ghost.state === "hit") ghostImg = ghostHit;
      if (ghost.state === "angry") ghostImg = ghostAngry;
      if (ghostImg.complete) {
        ctx.drawImage(ghostImg, ghost.x, ghost.y, ghost.size, ghost.size);
      }

      bullets.forEach(b => {
        ctx.fillStyle = "cyan";
        ctx.beginPath();
        ctx.arc(b.x, b.y, 5, 0, 2 * Math.PI);
        ctx.fill();
      });
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    loop();
  </script>
</body>
  </html>
